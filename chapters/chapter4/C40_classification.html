
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Classification &#8212; ML for Natural Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/chapter4/C40_classification';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Using sklearn models" href="../chapter3/C30_using_sklearn.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">ML for Natural Sciences</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Machine Learning for Natural Sciences
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter1/C10_object_oriented_programming.html">Object-oriented Programming in Python <a class="tocSkip"></a></a></li>




<li class="toctree-l1"><a class="reference internal" href="../chapter2/C20_optimization_basics.html">Basics of Optimization <a class="tocSkip"></a></a></li>





<li class="toctree-l1"><a class="reference internal" href="../chapter3/C30_using_sklearn.html">Using sklearn models <a class="tocSkip"></a></a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">Classification <a class="tocSkip"></a></a></li>




</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/gitpeblo/ML_book/blob/main/ML_book_site/chapters/chapter4/C40_classification.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/chapter4/C40_classification.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Classification <a class="tocSkip"></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Classification <a class="tocSkip"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simplest-case-1d-class-separation">The simplest case: 1D class separation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-logistic-regression-problem">Solving the Logistic Regression problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-conditional-likelihood">Calculating the conditional Likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-last-semplification-and-we-are-done">One last semplification, and we are done</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-gradient-descent">Using Gradient Descent</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thank-sklearn-for-one-liner-logisticregression">Thank sklearn for one-liner LogisticRegression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">Visualizing the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbors-classifier-a-k-a-knn"><span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbors classifier (a.k.a. <span class="math notranslate nohighlight">\(k\)</span>NN)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-the-1d-problem">Back to the 1D problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-in-multi-dimension-multi-class"><span class="math notranslate nohighlight">\(k\)</span>NN in multi-dimension, multi-class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-decision-boundaries">Visualizing the Decision Boundaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-decision-function">Visualizing the Decision Function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-of-performance">Metrics of Performance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#golden-rule-and-data-splitting">Golden rule and data splitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confusion-matrix">Confusion Matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics">Metrics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confusion-matrix-and-metrics-in-sklearn">Confusion Matrix and metrics in sklearn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-area-uder-the-curve-auc-metric">The Area Uder the Curve (AUC) metric</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drawing-the-roc-curve">Drawing the ROC curve</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-dataset">Preparing dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-roc-curve">Plot the ROC curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-agains-sklearn-function">Comparison agains sklearn function</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="classification">
<h1>Classification <a class="tocSkip"><a class="headerlink" href="#classification" title="Link to this heading">#</a></h1>
<font size=1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Paolo Bonfini, 2025. All rights reserved.
</pre></div>
</div>
<p>This work is the intellectual property of <code class="docutils literal notranslate"><span class="pre">Paolo</span> <span class="pre">Bonfini</span></code>. All content produced in this notebook is original creation of the author unless specified otherwise. Unauthorized use, reproduction, or distribution of this material, in whole or in part, without explicit permission from the author, is strictly prohibited.
</font></p>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;"></section>
<section class="tex2jax_ignore mathjax_ignore" id="the-simplest-case-1d-class-separation">
<h1>The simplest case: 1D class separation<a class="headerlink" href="#the-simplest-case-1d-class-separation" title="Link to this heading">#</a></h1>
<p>Let’s start from the <em>simplest</em> possible case <span class="math notranslate nohighlight">\(\rightarrow\)</span> a 1D case, with 2 classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span><span class="o">==</span><span class="mi">0</span><span class="p">)),</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class A&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span><span class="o">==</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class B&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1fefb833e22db149162148a5228382a9190717c6e52da9f67f39604e281b8737.png" src="../../_images/1fefb833e22db149162148a5228382a9190717c6e52da9f67f39604e281b8737.png" />
</div>
</div>
<p><strong>Q:</strong> How can I place a <strong>separation threshold</strong> between the two classes?</p>
<div class="alert alert-danger" role="alert" style="border-radius: 8px; padding: 10px;">
<details>
<p><b><summary>[Spoiler] (click here to expand)</summary></b></p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> We need to define a metric for <b>classification error</b>!</p>
</details>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="logistic-regression">
<h1>Logistic Regression<a class="headerlink" href="#logistic-regression" title="Link to this heading">#</a></h1>
<p>Let’s <strong>add the <span class="math notranslate nohighlight">\(y\)</span> dimension</strong>:</p>
<ul class="simple">
<li><p>we send class A to <span class="math notranslate nohighlight">\(\rightarrow\)</span> 0</p></li>
<li><p>we send class B to <span class="math notranslate nohighlight">\(\rightarrow\)</span> +1</p></li>
</ul>
<p>… and <strong>use a function</strong> to ‘fit’ the new distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">patches</span>

<span class="c1"># Create the additional dimension:</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>

<span class="c1"># Define a function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">logistic_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">x_half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">logistic_function</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">xx</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;Approximate position at which the function equals 0.5.&#39;&#39;&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>  <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class 0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span>   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">logistic_function</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mysterious function of unknow origin&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Draw arrows to the x-axis and y-axis:</span>
<span class="n">arrow_to_yaxis</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">FancyArrowPatch</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>    <span class="p">(</span><span class="n">x_half</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                 <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>
<span class="n">arrow_to_xaxis</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">FancyArrowPatch</span><span class="p">((</span><span class="n">x_half</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">x_half</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                 <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arrow_to_xaxis</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arrow_to_yaxis</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/21403d8263a896dbf2d5fe7279aac45b07393647ac84cd9c9c89518e41dc4112.png" src="../../_images/21403d8263a896dbf2d5fe7279aac45b07393647ac84cd9c9c89518e41dc4112.png" />
</div>
</div>
<p>If the function is symmetric:</p>
<blockquote>
<div><p><strong>separation threshold</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(x_t\)</span> | <span class="math notranslate nohighlight">\(f(x_t) = 0.5\)</span></p>
</div></blockquote>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x &lt;= x_t\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> class 0</p></li>
<li><p><span class="math notranslate nohighlight">\(x &gt;~~x_t\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> class 1</p></li>
</ul>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p>We need to fit our function to the data: <strong>classification</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <strong>regression</strong></p>
<p><u><strong>Linear Regression</strong></u> (reminder)</p>
<p>We saw that we can express the multi-dimensional <strong>linear</strong> regression model in <em>matrix notation</em> as:</p>
<div class="math notranslate nohighlight">
\[ \pmb{y} = \pmb{X} \pmb{\beta}\]</div>
<p>or equivalently, in <em>functional notation</em>, for sample <span class="math notranslate nohighlight">\(i\)</span>:</p>
<div class="math notranslate nohighlight">
\[ y_i = \sum_{j}^p w^j x_{i}^j = \pmb{w} \pmb{x_i} \]</div>
<p>where <span class="math notranslate nohighlight">\(j\)</span> is the feature index, and <span class="math notranslate nohighlight">\(\pmb{w} = [w^1, w^2, w^3, ... w^p]\)</span> is the vector of <em>weights</em>.<br>
<em>NOTE: We switch to this notation to follow the usual nomenclature for Logistic Regression.</em></p>
<p><u><strong>Logistic Regression</strong></u></p>
<p>Is simply a regression task in which we switch the fitting function:</p>
<div class="math notranslate nohighlight">
\[ y_i = \pmb{w} \pmb{x_i}\]</div>
<div class="math notranslate nohighlight">
\[\downarrow\]</div>
<div class="math notranslate nohighlight">
\[ y = {1 \over 1 + e^{-\pmb{w} \pmb{x}}}\]</div>
<p><em>(where we omit the sample index <span class="math notranslate nohighlight">\(i\)</span> for readibility)</em></p>
<p>And, as usual, <em>fitting</em> a [logistic] function means:</p>
<blockquote>
<div><p><u>Find the <span class="math notranslate nohighlight">\(\pmb{w}\)</span> that minimizes the residuals (<span class="math notranslate nohighlight">\(\hat{\pmb{w}}\)</span>)</u></p>
</div></blockquote>
<p>… although notice that this is NOT a linear model!</p>
<p><strong>Q:</strong> Can you invert the formula to find the <span class="math notranslate nohighlight">\(\pmb{w}\)</span> that minimizes the residuals?</p>
<div class="alert alert-danger" role="alert" style="border-radius: 8px; padding: 10px;">
<details>
<p><b><summary>[Spoiler] (click here to expand)</summary></b></p>
<p><i>Guess what …</i></p>
</details>
</div><section id="solving-the-logistic-regression-problem">
<h2>Solving the Logistic Regression problem<a class="headerlink" href="#solving-the-logistic-regression-problem" title="Link to this heading">#</a></h2>
<p>There is <u>no</u> closed form solution (<em>no analytical solution</em>).</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> We can solve by <strong>Gradient Descent</strong>!</p>
<p>But we need to <strong>re-formulate</strong> the problem a bit <em>more conveniently</em>.</p>
<p>Let’s see it in terms of <strong>probability</strong>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f148cc29-ed06-4ba5-a06a-d05d55909011">
<span class="eqno">(2)<a class="headerlink" href="#equation-f148cc29-ed06-4ba5-a06a-d05d55909011" title="Permalink to this equation">#</a></span>\[\begin{equation}
    p_1(\pmb{x}, \pmb{w}) = {1 \over 1 + e^{-\pmb{w} \pmb{x}}} \tag{Eq. 1}
\end{equation}\]</div>
<blockquote>
<div><p><span class="math notranslate nohighlight">\( p_1(\pmb{x}, \pmb{w})\)</span> is the <u>probability</u> to obtain class 1 for a given pair (<span class="math notranslate nohighlight">\(\pmb{x}\)</span>, <span class="math notranslate nohighlight">\(\pmb{w})\)</span></p>
</div></blockquote>
<p>Automatically, when there are only 2 classes:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f3a2b9a4-3af7-47ad-9e7f-455dcc02926f">
<span class="eqno">(3)<a class="headerlink" href="#equation-f3a2b9a4-3af7-47ad-9e7f-455dcc02926f" title="Permalink to this equation">#</a></span>\[\begin{equation}
    p_0(\pmb{x}, \pmb{w}) = 1 - p_1(\pmb{x}, \pmb{w}) = 1 - {1 \over 1 + e^{-\pmb{w} \pmb{x}}} \tag{Eq. 2}
\end{equation}\]</div>
<blockquote>
<div><p>where <span class="math notranslate nohighlight">\( p_0(\pmb{x}, \pmb{w})\)</span> is the <u>probability</u> to obtain class 0 for a given pair (<span class="math notranslate nohighlight">\(\pmb{x}\)</span>, <span class="math notranslate nohighlight">\(\pmb{w})\)</span></p>
</div></blockquote>
<p>We can then solve the problem by maximizing the <strong>conditional Likelihood</strong>:</p>
<div class="math notranslate nohighlight">
\[ P(\pmb{y} | \pmb{X}, \pmb{w})\]</div>
<blockquote>
<div><p>i.e., the probability to have obtained the <strong>observed</strong> classes <span class="math notranslate nohighlight">\(\pmb{y}\)</span> (<em>of all samples</em>) if we were given <span class="math notranslate nohighlight">\(\pmb{X}\)</span> (<em>of all samples</em>) and our Logistic model with weigths <span class="math notranslate nohighlight">\(\pmb{w}\)</span> was a correct assumption</p>
</div></blockquote>
<p><em>NOTE: Read this statement again, carefully.</em></p>
<section id="calculating-the-conditional-likelihood">
<h3>Calculating the conditional Likelihood<a class="headerlink" href="#calculating-the-conditional-likelihood" title="Link to this heading">#</a></h3>
<p><span class="math notranslate nohighlight">\( P(\pmb{y} | \pmb{X}, \pmb{w})\)</span> is the <strong>total probability</strong> for the whole dataset <span class="math notranslate nohighlight">\(\pmb{X}\)</span> with labels <span class="math notranslate nohighlight">\(\pmb{y}\)</span>.</p>
<p>If each datapoint is <strong>i.i.d.</strong> (= <em>independent and identically distributed random variables</em>), the total probability is given by the <strong>multiplication</strong> of the idividual probabilities of each sample <span class="math notranslate nohighlight">\(i\)</span>:</p>
<div class="math notranslate nohighlight">
\[ P(\pmb{y} | \pmb{X}, \pmb{w}) = P(y_0 | \pmb{x}_0, \pmb{w}) \times P(y_1 | \pmb{x}_1, \pmb{w}) \times P(y_2 | \pmb{x}_2, \pmb{w}) ... \times~P(y_n | \pmb{x}_n, \pmb{w}) \]</div>
<p><em>E.g.: I flip a coin 10 times, which is the probability to obtain 10 heads (= class 1)?</em></p>
<p><em>IMPORTANT:</em> <span class="math notranslate nohighlight">\(\pmb{x}_i\)</span> (one sample) is a vector of <span class="math notranslate nohighlight">\(p\)</span> features: <span class="math notranslate nohighlight">\(\pmb{x}_i = [x^0_i, x^1_i, x^2_i, ..., x^p_i]\)</span>, but it has 1 single label: <span class="math notranslate nohighlight">\(y_i\)</span>.</p>
<p>We can write this <strong>compactly</strong> as:</p>
<div class="math notranslate nohighlight">
\[ P(\pmb{y} | \pmb{X}, \pmb{w}) = \Pi_i P(y_i | \pmb{x_i}, \pmb{w}) \]</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p>Therefore, finding the <strong>best-fitting</strong> <span class="math notranslate nohighlight">\(\pmb{w}\)</span> becomes this problem:</p>
<div class="math notranslate nohighlight">
\[ \pmb{w} = \operatorname{argmax_{\pmb{w}}} \Pi_i P(y_i | \pmb{x_i}, \pmb{w}) \]</div>
<p><strong>However</strong>, dealing with <em>products</em> is usually complicated <span class="math notranslate nohighlight">\(\rightarrow\)</span> we take the <strong>log</strong> (so <span class="math notranslate nohighlight">\(\Pi\)</span> becomes a <span class="math notranslate nohighlight">\(\sum\)</span>)</p>
<blockquote>
<div><p><em>If <span class="math notranslate nohighlight">\(\pmb{w}\)</span> maximizes the <span class="math notranslate nohighlight">\(\Pi_i P(y_i | \pmb{x_i}, \pmb{w})\)</span>, it also maximises its log</em></p>
</div></blockquote>
<div class="amsmath math notranslate nohighlight" id="equation-56b588d8-9da9-46b3-a646-62c8a51bd851">
<span class="eqno">(4)<a class="headerlink" href="#equation-56b588d8-9da9-46b3-a646-62c8a51bd851" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \pmb{w} = \operatorname{argmax_{\pmb{w}}} \sum_i log P(y_i | \pmb{x_i}, \pmb{w}) \tag{Eq. 3}
\end{equation}\]</div>
</section>
<section id="one-last-semplification-and-we-are-done">
<h3>One last semplification, and we are done<a class="headerlink" href="#one-last-semplification-and-we-are-done" title="Link to this heading">#</a></h3>
<p>We just have to write <span class="math notranslate nohighlight">\(log P(y_i | \pmb{x_i}, \pmb{w})\)</span>, <u>completely equivalently</u>, with this <strong>old-school trick</strong>:</p>
<div class="math notranslate nohighlight">
\[P(y_i | \pmb{x_i}, \pmb{w}) ~~:=~~ y_i \times log P(y_i=1 | \pmb{x_i}, \pmb{w}) ~~~+~~~ (1 - y_i) \times log P(y_i=0 | \pmb{x_i}, \pmb{w})\]</div>
<blockquote>
<div><p><em>Because, given a sample <span class="math notranslate nohighlight">\(i\)</span></em></p>
<ul class="simple">
<li><p><em>if its <span class="math notranslate nohighlight">\(y_i\)</span> equals 1 <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(log P(y_i | \pmb{x_i}, \pmb{w}) = log P(y_i=1 | \pmb{x_i}, \pmb{w}) + 0\)</span></em></p></li>
<li><p><em>if its <span class="math notranslate nohighlight">\(y_i\)</span> equals 0 <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(log P(y_i | \pmb{x_i}, \pmb{w}) = 0 + log P(y_i=0 | \pmb{x_i}, \pmb{w})\)</span></em></p></li>
</ul>
<p><em>so the definition holds no matter the actual label.</em></p>
</div></blockquote>
<p>Or, if you like this nomenclature better:</p>
<div class="math notranslate nohighlight">
\[log P(y_i | \pmb{x_i}, \pmb{w}) ~~:=~~ y_i \times log~ p_1(\pmb{x_i}, \pmb{w}) ~~~+~~~  (1 - y_i) \times log~ p_0(\pmb{x_i}, \pmb{w})\]</div>
<p>To conclude, we substitute <strong>Equation 1</strong> and <strong>2</strong>:</p>
<div class="math notranslate nohighlight">
\[log P(y_i | \pmb{x_i}, \pmb{w}) ~~=~~ y_i \times log \big[ {1 \over 1 + e^{-\pmb{w} \pmb{x}}} \big] ~~~+~~~ (1 - y_i) \times log \big[ 1 - {1 \over 1 + e^{-\pmb{w} \pmb{x}}} \big]\]</div>
</section>
<section id="using-gradient-descent">
<h3>Using Gradient Descent<a class="headerlink" href="#using-gradient-descent" title="Link to this heading">#</a></h3>
<p>We now have all the elements in Equation 3:</p>
<div class="math notranslate nohighlight">
\[\pmb{w} = \operatorname{argmax_{\pmb{w}}} \sum_i log P(y_i | \pmb{x_i}, \pmb{w}) \]</div>
<p>This is a <strong>maximization</strong> problem.<br>
But no worries! <span class="math notranslate nohighlight">\(\rightarrow\)</span> We just add a “<span class="math notranslate nohighlight">\(-\)</span>” and becomes the good ol’ <strong>minimization</strong> we saw in the previous lecture:</p>
<div class="math notranslate nohighlight">
\[\pmb{w} = \operatorname{argmin_{\pmb{w}}} -\sum_i log P(y_i | \pmb{x_i}, \pmb{w}) \]</div>
<p>where we call the summatory “<strong>conditional log Likelihood</strong>”, <span class="math notranslate nohighlight">\(l(\pmb{w})\)</span>:</p>
<div class="math notranslate nohighlight">
\[ l(\pmb{w}) := -\sum_i log P(y_i | \pmb{x_i}, \pmb{w}) \]</div>
<p>The solution <span class="math notranslate nohighlight">\(\pmb{\hat{w}}\)</span> can be iteratively found using <strong>Gradient Descent</strong> to minimize <span class="math notranslate nohighlight">\(l(\pmb{w})\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
 \pmb{w}^\prime \leftarrow \pmb{w} - \eta \nabla l(\pmb{w})
\end{equation}
\]</div>
<p>REMINDER:
$<span class="math notranslate nohighlight">\(\nabla l(\pmb{w}) = [{\partial \over \partial w^0}l(\pmb{w}), {\partial \over \partial w^1}l(\pmb{w}),, {\partial \over \partial w^2}l(\pmb{w}), ... {\partial \over \partial w^p}l(\pmb{w}) ]\)</span>$</p>
</section>
</section>
<section id="thank-sklearn-for-one-liner-logisticregression">
<h2>Thank sklearn for one-liner LogisticRegression<a class="headerlink" href="#thank-sklearn-for-one-liner-logisticregression" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Same data as above, but formatted for sklearn:</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;NOTE: The random state is for the Gradient Descent.&#39;&#39;&#39;</span>

<span class="c1"># Predicting</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">3</span><span class="p">]]</span> <span class="c1"># don&#39;t forget that sklearn expects 2D inputs</span>
<span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1])
</pre></div>
</div>
</div>
</div>
<p>Which is the <strong>probability</strong> that <code class="docutils literal notranslate"><span class="pre">X_test</span></code> is class 0 or 1?</p>
<p><span class="math notranslate nohighlight">\(p_1\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> It is <em>literally</em> the value on the <strong>Logistic Function</strong> curve!</p>
<p>We can get <span class="math notranslate nohighlight">\(p_0\)</span> and <span class="math notranslate nohighlight">\(p_1\)</span> as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.28107324, 0.71892676]])
</pre></div>
</div>
</div>
</div>
<p>Where, by definition: <span class="math notranslate nohighlight">\(p_0 = 1 - p_1\)</span></p>
<section id="visualizing-the-results">
<h3>Visualizing the results<a class="headerlink" href="#visualizing-the-results" title="Link to this heading">#</a></h3>
<p>To visualize the <strong>Logistic Function curve</strong>, let’s predict along all the <span class="math notranslate nohighlight">\(x\)</span>-axis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">yy_model</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="sd">&#39;&#39;&#39;NOTE: We keep only [:, 1], i.e. p_1, or else we would plot two symmetric</span>
<span class="sd">         curves!</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c1">#yy_model = clf.predict_proba(xx.reshape(-1, 1)) # uncomment to visualize both curves</span>
</pre></div>
</div>
</div>
</div>
<p>and plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yhat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="sd">&#39;&#39;&#39;NOTE: Keeping only p1 also for `X_test`&#39;&#39;&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>  <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;true class 0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span>   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;true class 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy_model</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted logistic funcion&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Draw segments to the x-axis and y-axis:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;$X_</span><span class="si">{test}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decision threshold&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/aad6edd61f6c52253e0e3cc2215d193b61a82ecafd960bf7a4b493b86ca87462.png" src="../../_images/aad6edd61f6c52253e0e3cc2215d193b61a82ecafd960bf7a4b493b86ca87462.png" />
</div>
</div>
<p><u>NOTE</u></p>
<p>In the book you will find the Logistic Regression classifier used <u>not</u> via <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> <span class="math notranslate nohighlight">\(-\)</span> but via the <strong>Stochastic Gradient Descent</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="n">sgd_clf</span> <span class="o">=</span> <span class="n">SGDClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;log_loss&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And this is because <code class="docutils literal notranslate"><span class="pre">SGD</span></code> + <code class="docutils literal notranslate"><span class="pre">log_loss</span></code> == <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code></p>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=6><strong>Exercise [20 min]</strong></font></p>
<p><strong>Objective:</strong> Try to predict if a person “Survived”, in the provided “Titanic” test set.</p>
<p><strong>Tasks:</strong></p>
<ol class="arabic simple">
<li><p>Use all <strong>numerical</strong> features (<em>discard the categorical features, such as strings</em>) to <em>train</em> a <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> model</p></li>
<li><p>Predict <strong>the percentage</strong> of passengers in the <em>test</em> set who survived</p></li>
<li><p>The test set has no “Survived” column to know the <em>ground truth</em>, how to check if the results make sense?<br>
 <span class="math notranslate nohighlight">\(\rightarrow\)</span> <strong>compare</strong> the distributions of probabilities in the train and test sets using <strong>histograms</strong>.</p></li>
</ol>
<p><strong>Hints:</strong></p>
<ul>
<li><p><em>For task 1</em> <span class="math notranslate nohighlight">\(-\)</span> You can list the data types as:<br></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="n">df_data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</li>
<li><p><em>For task 1</em> <span class="math notranslate nohighlight">\(-\)</span> You can extract columns from a dataframe as:<br></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">&lt;</span><span class="n">column_names</span><span class="o">&gt;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</li>
<li><p><em>For task 3</em> <span class="math notranslate nohighlight">\(-\)</span> First, predict the probabilities for all the samples in the train/test sets with <code class="docutils literal notranslate"><span class="pre">predict_proba()</span></code></p></li>
<li><p><em>Do not hit any iceberg on the way</em></p></li>
</ul>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Load dataset</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;titanic&quot;</span><span class="p">)</span>

<span class="c1"># Drop columns overfilled with &#39;NaN&#39;</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;deck&quot;</span><span class="p">])</span>

<span class="c1"># Drop rows with &#39;NaN&#39; or icebergs:</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Split (e.g., 80% train, 20% test)</span>
<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;survived&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>599</th>
      <td>1</td>
      <td>1</td>
      <td>male</td>
      <td>49.0</td>
      <td>1</td>
      <td>0</td>
      <td>56.9292</td>
      <td>C</td>
      <td>First</td>
      <td>man</td>
      <td>True</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <th>37</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>21.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.0500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
    <tr>
      <th>555</th>
      <td>0</td>
      <td>1</td>
      <td>male</td>
      <td>62.0</td>
      <td>0</td>
      <td>0</td>
      <td>26.5500</td>
      <td>S</td>
      <td>First</td>
      <td>man</td>
      <td>True</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
    <tr>
      <th>810</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.8875</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
    <tr>
      <th>360</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>40.0</td>
      <td>1</td>
      <td>4</td>
      <td>27.9000</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>Southampton</td>
      <td>no</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>190</th>
      <td>1</td>
      <td>2</td>
      <td>female</td>
      <td>32.0</td>
      <td>0</td>
      <td>0</td>
      <td>13.0000</td>
      <td>S</td>
      <td>Second</td>
      <td>woman</td>
      <td>False</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <th>292</th>
      <td>0</td>
      <td>2</td>
      <td>male</td>
      <td>36.0</td>
      <td>0</td>
      <td>0</td>
      <td>12.8750</td>
      <td>C</td>
      <td>Second</td>
      <td>man</td>
      <td>True</td>
      <td>Cherbourg</td>
      <td>no</td>
      <td>True</td>
    </tr>
    <tr>
      <th>762</th>
      <td>1</td>
      <td>3</td>
      <td>male</td>
      <td>20.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.2292</td>
      <td>C</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <th>737</th>
      <td>1</td>
      <td>1</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>512.3292</td>
      <td>C</td>
      <td>First</td>
      <td>man</td>
      <td>True</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <th>812</th>
      <td>0</td>
      <td>2</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>10.5000</td>
      <td>S</td>
      <td>Second</td>
      <td>man</td>
      <td>True</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The attributes have the following meaning:</p>
<ul class="simple">
<li><p><strong>survived</strong>: target variable, 0 means the passenger did not survive, while 1 means they survived.</p></li>
<li><p><strong>pclass</strong>: passenger class.</p></li>
<li><p><strong>sex</strong>: gender of the passenger.</p></li>
<li><p><strong>age</strong>: age of the passenger in years.</p></li>
<li><p><strong>sibsp</strong>: number of siblings and spouses aboard the Titanic.</p></li>
<li><p><strong>parch</strong>: number of parents and children aboard the Titanic.</p></li>
<li><p><strong>fare</strong>: price paid (in pounds).</p></li>
<li><p><strong>embarked</strong>: port of embarkation (coded as C = Cherbourg, Q = Queenstown, S = Southampton).</p></li>
<li><p><strong>class</strong>: string version of passenger class.</p></li>
<li><p><strong>who</strong>: description of the passenger type (man, woman, child).</p></li>
<li><p><strong>adult_male</strong>: whether the passenger is an adult male.</p></li>
<li><p><strong>deck</strong>: deck where the cabin was located.</p></li>
<li><p><strong>embark_town</strong>: full name of the embarkation town.</p></li>
<li><p><strong>alive</strong>: string indicating if the passenger survived.</p></li>
<li><p><strong>alone</strong>: whether the passenger was travelling alone.</p></li>
</ul>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p><em>Our solution</em></p>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Selecting features and creating sets:</span>
<span class="n">columns_numericals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pclass&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;sibsp&#39;</span><span class="p">,</span> <span class="s1">&#39;parch&#39;</span><span class="p">,</span> <span class="s1">&#39;fare&#39;</span><span class="p">]</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">columns_numericals</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;survived&#39;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">columns_numericals</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. Fitting on train set:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">yhat_train</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">yhat_test</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Survived:</span>
<span class="n">n_survived</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yhat_test</span><span class="p">[</span><span class="n">yhat_test</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span>
<span class="n">perc_survived</span> <span class="o">=</span> <span class="n">n_survived</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">yhat_test</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f%%</span><span class="s1"> of passengers in the test set are expected to have survived&#39;</span> <span class="o">%</span> <span class="n">perc_survived</span><span class="p">)</span>

<span class="c1"># 3. Comparing probability distributions:</span>
<span class="n">phat_train</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">phat_test</span>  <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison of survival probability distributions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">phat_train</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">phat_test</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30.77% of passengers in the test set are expected to have survived
</pre></div>
</div>
<img alt="../../_images/bab31326ed91c392bbca35c9af44e2e4aa03245d563c51f2fafc385b28471bfc.png" src="../../_images/bab31326ed91c392bbca35c9af44e2e4aa03245d563c51f2fafc385b28471bfc.png" />
</div>
</details>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="k-nearest-neighbors-classifier-a-k-a-knn">
<h1><span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbors classifier (a.k.a. <span class="math notranslate nohighlight">\(k\)</span>NN)<a class="headerlink" href="#k-nearest-neighbors-classifier-a-k-a-knn" title="Link to this heading">#</a></h1>
<p>The <strong><span class="math notranslate nohighlight">\(k\)</span>NN classifier</strong> is arguably the simples ML algorithm:</p>
<blockquote>
<div><p><strong>Train</strong> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <em>Store all the data (and relative distances)</em></p>
<p><strong>Predict</strong> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <em>Return majority label of the closest <span class="math notranslate nohighlight">\(k\)</span> instances</em></p>
</div></blockquote>
<div>
   <img src="attachment:kNN.png" width="600">
</div>
<table><tr>
    <td width=500>
        <center>
            <br>
            Figure 1. Prediction stage of a $k$NN classifier with $k$ = 3.<br>
            (From Figure 1-15 in Gerone's book)
        </center>
    </td>
</tr></table>
<p>How to deal with <strong>ties</strong>?<br>
<em>(e.g. <span class="math notranslate nohighlight">\(k = 2\)</span>, and the one sample is class 0, while the other is class 1)?</em></p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>Return class of <strong>closest</strong> neighbor</em><br>
or<br>
<span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>Return a <strong>random</strong> class</em><br>
or<br>
<span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>Return the class of the <strong>first</strong> of the <span class="math notranslate nohighlight">\(k\)</span> neighbors</em> (<em><code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s default</em>)<br>
or<br>
… <em>your made up rule</em></p>
</div></blockquote>
<p>If you want to avoid troubles <span class="math notranslate nohighlight">\(-\)</span> if you have:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>even</strong> number of classes <span class="math notranslate nohighlight">\(\rightarrow\)</span> pick an <strong>odd</strong> <span class="math notranslate nohighlight">\(k\)</span></p></li>
<li><p><strong>odd</strong> number of classes <span class="math notranslate nohighlight">\(\rightarrow\)</span> pick an <strong>even</strong> <span class="math notranslate nohighlight">\(k\)</span></p></li>
</ul>
</div></blockquote>
<section id="back-to-the-1d-problem">
<h2>Back to the 1D problem<a class="headerlink" href="#back-to-the-1d-problem" title="Link to this heading">#</a></h2>
<p>Let’s go back to the 1D problem and try to classify the <span class="math notranslate nohighlight">\(X_{test}\)</span> point using <span class="math notranslate nohighlight">\(k\)</span>NN.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.9</span><span class="p">]]</span>  <span class="c1"># sklearn expects 2D input</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span><span class="o">==</span><span class="mi">0</span><span class="p">)),</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class 0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span><span class="o">==</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;class 1&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;forestgreen&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$X_</span><span class="si">{test}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dbd00bad0283f4c2464b20b1296aa9dea96c055d75c9a486586a5b84cb9633c4.png" src="../../_images/dbd00bad0283f4c2464b20b1296aa9dea96c055d75c9a486586a5b84cb9633c4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsClassifier</span>

<span class="c1"># Same data as above, but formatted for sklearn:</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;brute&#39;</span><span class="p">)</span><span class="c1">#, weights=&#39;distance&#39;)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;NOTE: This is a tie case.  `KNeighborsClassifier` will return the class of</span>
<span class="sd">         the first of the k neighbors it encounters.</span>
<span class="sd">         </span>
<span class="sd">         Uncomment the `weights` argument, and see how the classification</span>
<span class="sd">         changes when the distances are taken into account.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># Predict:</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.9</span><span class="p">]]</span> <span class="c1"># don&#39;t forget that sklearn expects 2S inputs</span>
<span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0])
</pre></div>
</div>
</div>
</div>
<p>As for <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code>, also for <code class="docutils literal notranslate"><span class="pre">KNeighborsClassifier</span></code> we can get the <strong>probabilities</strong> <span class="math notranslate nohighlight">\(p_0\)</span> and <span class="math notranslate nohighlight">\(p_1\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.5, 0.5]])
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> How can <code class="docutils literal notranslate"><span class="pre">KNeighborsClassifier</span></code> <strong>calculate</strong> those probabilities? (<em>In-class discussion</em>)</p>
<div class="alert alert-danger" role="alert" style="border-radius: 8px; padding: 10px;">
<details>
<p><b><summary>[Spoiler] (click here to expand)</summary></b></p>
<p>Probability of class <span class="math notranslate nohighlight">\(c\)</span>:
$<span class="math notranslate nohighlight">\( p_c = {\mathcal{N}(y_i == c)\over k } ~~~,~~~for~i~\in~set(neighbors)\)</span>$</p>
</details>
</div></section>
<section id="knn-in-multi-dimension-multi-class">
<h2><span class="math notranslate nohighlight">\(k\)</span>NN in multi-dimension, multi-class<a class="headerlink" href="#knn-in-multi-dimension-multi-class" title="Link to this heading">#</a></h2>
<p>As many other classifiers <span class="math notranslate nohighlight">\(-\)</span> <code class="docutils literal notranslate"><span class="pre">KNeighborsClassifier</span></code> <em>generalizes</em> to <strong>multi-dimension</strong>, <strong>multi-class</strong>.</p>
<blockquote>
<div><p>3 classes, 2 features.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsClassifier</span>

<span class="c1"># Let&#39;s create some mock data:</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">class_sep</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;C2&#39;</span><span class="p">}</span>
<span class="c1"># colors dictionary indexed by class label</span>

<span class="c1"># Plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b98afac5bbe0c1331e765bc1d96be552452b70f5025632e65ecc87b4b797058a.png" src="../../_images/b98afac5bbe0c1331e765bc1d96be552452b70f5025632e65ecc87b4b797058a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit:</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">IMPORTANT: We should have normalized the data first, to make sure that the</span>
<span class="sd">    distance between points is not dominated by the feature with the largest</span>
<span class="sd">    dynamical range.</span>
<span class="sd"> </span>
<span class="sd">    In this case, though, we shall not worry as the features are already</span>
<span class="sd">    scaled when they have been generated by `make_classification`.</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">;</span>

<span class="c1"># Predict:</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">yhat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 

<span class="c1"># Plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">yhat_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;$X_</span><span class="si">{test}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/defd4d83564e4d7f06be349526b59e9cacb65dd35280c57aaad87fdc391f0414.png" src="../../_images/defd4d83564e4d7f06be349526b59e9cacb65dd35280c57aaad87fdc391f0414.png" />
</div>
</div>
<section id="visualizing-the-decision-boundaries">
<h3>Visualizing the Decision Boundaries<a class="headerlink" href="#visualizing-the-decision-boundaries" title="Link to this heading">#</a></h3>
<p>So we have a <em>trained classifier</em> <code class="docutils literal notranslate"><span class="pre">clf</span></code>.</p>
<p>How can we see the <strong>boundaries</strong> between classes?</p>
<blockquote>
<div><p><em>In other words: we want to display which area of the plot belong to a class or another</em></p>
</div></blockquote>
<p>By repeating the prediction at <em>each and every point</em> in the feature space, we may visualize the <strong>decision surface</strong>:
<br><br></p>
<a class="reference internal image-reference" href="../../_images/kNN_decision_function_animation.gif"><img alt="../../_images/kNN_decision_function_animation.gif" src="../../_images/kNN_decision_function_animation.gif" style="width: 600px;" />
</a>
<table><tr>
    <td width=800>
        <center>
            <br>
            Figure 1. Application of a k-NN classifier considering k = 3 neighbors. Left - Given the test point "?", the algorithm seeks the 3 closest points in the training set, and adopts the majority vote to classify it as "class red". Right - By iteratively repeating the prediction over the whole feature space (X1, X2), one can depict the "decision surface".<br>
            (Image credits: Paolo Bonfini)
        </center>
    </td>
</tr></table>
<p>Brute force! <span class="math notranslate nohighlight">\(\rightarrow\)</span> We apply <code class="docutils literal notranslate"><span class="pre">predict()</span></code> on <em>all</em> points on the whole (<span class="math notranslate nohighlight">\(X^1\)</span>, <span class="math notranslate nohighlight">\(X^2\)</span>) plane!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a grid of points to make predictions:</span>
<span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The grid we created contains </span><span class="si">%s</span><span class="s1"> points&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xx1</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Use the KNN classifier to make predictions on the grid:</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">xx2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
<span class="sd">&#39;&#39;&#39;Here is where the magic happens! Above we have created the (x1, x2) grid,</span>
<span class="sd">and now we calculate the class for each and every point.&#39;&#39;&#39;</span>

<span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Create a contour plot to display the decision boundaries:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decision Boundaries&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The grid we created contains 9672 points
</pre></div>
</div>
<img alt="../../_images/0be63fa2bafea7a2e001acefa857fc2427d590c9cdcad16b846fe8bd784a1945.png" src="../../_images/0be63fa2bafea7a2e001acefa857fc2427d590c9cdcad16b846fe8bd784a1945.png" />
</div>
</div>
</section>
<section id="visualizing-the-decision-function">
<h3>Visualizing the Decision Function<a class="headerlink" href="#visualizing-the-decision-function" title="Link to this heading">#</a></h3>
<p><em>Slight variation on the subject …</em></p>
<p><strong>Q:</strong> How can we <strong>visualize the probability</strong> of a new sample <span class="math notranslate nohighlight">\(X_{test}\)</span> would be classified as class 0, 1, or 2?</p>
<div class="alert alert-danger" role="alert" style="border-radius: 8px; padding: 10px;">
<details>
<p><b><summary>[Spoiler] (click here to expand)</summary></b></p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> We calculate <code>predict_proba()</code> on the whole (<span class="math notranslate nohighlight">\(X^1\)</span>, <span class="math notranslate nohighlight">\(X^2\)</span>) plane!</p>
<p><i>NOTE: Since we have 3 classes, for each point <code>predict_proba()</code> will return 3 values (<span class="math notranslate nohighlight">\(p_0\)</span>, <span class="math notranslate nohighlight">\(p_1\)</span>, <span class="math notranslate nohighlight">\(p_2\)</span>)</i></p>
</details>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a grid of points to make predictions:</span>
<span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The grid we created contains </span><span class="si">%s</span><span class="s1"> points&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xx1</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Use the KNN classifier to make predictions on the grid:</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">xx2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
<span class="sd">&#39;&#39;&#39;Here is where the magic happens! Above we have created the (x1, x2) grid,</span>
<span class="sd">and now we calculate the probabilities for each and every point.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;--&gt; For each point, we have </span><span class="si">%s</span><span class="s2"> probabilities, so the P matrix has shape: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Z</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Z</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">P matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>

<span class="n">P0</span> <span class="o">=</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="sd">&#39;&#39;&#39;We decide to display the probability to belong to class 0&#39;&#39;&#39;</span>

<span class="c1"># Plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Create a filled contour plot to visualize the smoothed data:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span><span class="p">,</span> <span class="n">P0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decision Function for class 0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The grid we created contains 9672 points
&#39;--&gt; For each point, we have 104 probabilities, so the P matrix has shape: (93, 104)

P matrix:
 [[2 2 2 ... 1 1 1]
 [2 2 2 ... 1 1 1]
 [2 2 2 ... 1 1 1]
 ...
 [0 0 0 ... 1 1 1]
 [0 0 0 ... 1 1 1]
 [0 0 0 ... 1 1 1]]
</pre></div>
</div>
<img alt="../../_images/119cd7d46baf101f5b847d7b7995ba6a58b54788365d67da9ff708e6b381d69a.png" src="../../_images/119cd7d46baf101f5b847d7b7995ba6a58b54788365d67da9ff708e6b381d69a.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="metrics-of-performance">
<h1>Metrics of Performance<a class="headerlink" href="#metrics-of-performance" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><em>a.k.a. “How do I check I am doing this right?”</em></p>
</div></blockquote>
<p>First of all <span class="math notranslate nohighlight">\(-\)</span> in order to assess a model <strong>performance</strong> we need to decide on <em>what</em> to assess it.</p>
<section id="golden-rule-and-data-splitting">
<h2>Golden rule and data splitting<a class="headerlink" href="#golden-rule-and-data-splitting" title="Link to this heading">#</a></h2>
<a class="reference internal image-reference" href="../../_images/Train_Test.png"><img alt="../../_images/Train_Test.png" src="../../_images/Train_Test.png" style="width: 600px;" />
</a>
<table><tr>
    <td width=640>
        <center>
            <br>
            Figure 2.  Indicative recipe for splitting a dataset into the analysis sets.<br>
            For very large datasets (above 10$^5$ entries), the percentage dedicated to test can be substantially smaller.
            <br>
        </center>
    </td>
</tr></table>
<p>What are the different sets for? We already had a hint from the <em>previous</em> lectures.</p>
<ul class="simple">
<li><p><strong>Train</strong> set <span class="math notranslate nohighlight">\(~~~~~~\rightarrow\)</span> <strong>Learn</strong> the model parameters</p></li>
<li><p><strong>Test</strong> set <span class="math notranslate nohighlight">\(~~~~~~~\rightarrow\)</span> <strong>Assess</strong> the model performance</p></li>
</ul>
<blockquote>
<div><p><em>Assessing on the train set would lead to overfitting.</em></p>
</div></blockquote>
<p>This is easily done in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> via <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1">#, random_state=42) </span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total datast size: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;--&gt; Train set size: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;--&gt; Test  set size: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total datast size: 100
&#39;--&gt; Train set size: 80
&#39;--&gt; Test  set size: 20
</pre></div>
</div>
</div>
</div>
<p><u><strong>Golden Rule</strong></u></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;Train on train, test on test.&quot;
</pre></div>
</div>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">fit()</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> applies only to <span class="math notranslate nohighlight">\(X_{train}\)</span></p>
</div></blockquote>
<p>Violation of the Golden Rule can lead to disastrous <strong>data leaks</strong> and <strong>performance overestimation</strong>.</p>
<a class="reference internal image-reference" href="../../_images/nero.png"><img alt="../../_images/nero.png" src="../../_images/nero.png" style="width: 400px;" />
</a>
<table><tr>
    <td width=640>
        <center>
            <br>
            Figure 3.  Rome burns after Nero violated the Golden Rule.
            <br>
        </center>
    </td>
</tr></table>
<p>Big NO-NOs:</p>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_n</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_train_n</span><span class="p">,</span> <span class="n">X_test_n</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_n</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_n</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="confusion-matrix">
<h2>Confusion Matrix<a class="headerlink" href="#confusion-matrix" title="Link to this heading">#</a></h2>
<p>We can build classification metrics by considering the possible <strong>combinations of errors</strong>.</p>
<p>In the case of 2 classes, we can easily display the <strong>Confusion Matrix</strong>:</p>
<a class="reference internal image-reference" href="../../_images/confusion_matrix.png"><img alt="../../_images/confusion_matrix.png" src="../../_images/confusion_matrix.png" style="width: 300px;" />
</a>
<blockquote>
<div><p><em>You can read this as:</em><br>
$<span class="math notranslate nohighlight">\( (y = \hat{y})?~\hat{y} \)</span><span class="math notranslate nohighlight">\(
_E.g. False Positive:&lt;br&gt;
\)</span>\quad \hat{y}<span class="math notranslate nohighlight">\( \)</span>\rightarrow<span class="math notranslate nohighlight">\( Positive, but \)</span>y != \hat{y}<span class="math notranslate nohighlight">\( \)</span>\rightarrow$ False._</p>
</div></blockquote>
</section>
<section id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Link to this heading">#</a></h2>
<p>We can literally create <strong>any</strong> metric by combining these quantities:</p>
<ul class="simple">
<li><p><strong>TP</strong> = True Positives</p></li>
<li><p><strong>TP</strong> = False Positives</p></li>
<li><p><strong>FN</strong> = False Negatives</p></li>
<li><p><strong>TN</strong> = True Negatives</p></li>
<li><p><strong>P</strong> = all actual positives = TP + FN</p></li>
<li><p><strong>N</strong> = all actual negatives = TN + FP</p></li>
</ul>
<p>Some of the most <strong>common metrics</strong> (<a class="reference external" href="https://en.wikipedia.org/wiki/Confusion_matrix">here is a complete list</a>):</p>
<div class="math notranslate nohighlight">
\[ Accuracy ~=~ {all~correct~predictions \over all~data} ~=~ {TP + TN \over P + N }\]</div>
<div class="math notranslate nohighlight">
\[ Recall ~=~ {correct~positives \over all~actual~positives} ~=~ {TP \over P}\]</div>
<div class="math notranslate nohighlight">
\[ Precision  ~=~ {correct~positives \over whatever~was~predicted~positive} ~=~ {TP \over TP + FP}\]</div>
<p>When to use <em>one</em> or the <em>other</em>? <span class="math notranslate nohighlight">\(\rightarrow\)</span> <u>depends on the task</u></p>
<blockquote>
<div><p>Scenario 1: We are testing a CT-scan machine that may potentially kill the patient (positive = “survive”)<br>
    <em>We want to minimize <strong>false positives</strong> (i.e., minimize risk of death)</em> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>maximize <strong>Precision</strong></em></p>
</div></blockquote>
<blockquote>
<div><p>Scenario 2: We want to hospitalize patients at risk for a health check (positive = “hospitalize”)<br>
    <em>We want to maximize <strong>true positives</strong> (i.e. hospitalize as many people actually at risk)</em> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>maximize <strong>Recall</strong></em></p>
</div></blockquote>
</section>
<section id="confusion-matrix-and-metrics-in-sklearn">
<h2>Confusion Matrix and metrics in sklearn<a class="headerlink" href="#confusion-matrix-and-metrics-in-sklearn" title="Link to this heading">#</a></h2>
<p>There are several <strong>ready</strong> functions for most of the metrics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Let&#39;s create some mock data:</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">class_sep</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;C1&#39;</span><span class="p">}</span>
<span class="c1"># colors dictionary indexed by class label</span>

<span class="c1"># Plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f6758b5ea214a859d5775fa3d88f44b28c86de76483f1126f9869d5ad1dd4fa0.png" src="../../_images/f6758b5ea214a859d5775fa3d88f44b28c86de76483f1126f9869d5ad1dd4fa0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsClassifier</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> 

<span class="n">clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Confusion matrix:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="n">yhat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cm</span><span class="p">)</span>

<span class="c1"># .. or, use the more complete `metrics.classification_report`:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Classification report:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">yhat_test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion matrix: </span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">yhat_test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[101   3]
 [  9  87]]

Classification report:

               precision    recall  f1-score   support

           0       0.92      0.97      0.94       104
           1       0.97      0.91      0.94        96

    accuracy                           0.94       200
   macro avg       0.94      0.94      0.94       200
weighted avg       0.94      0.94      0.94       200

Confusion matrix: 

 [[101   3]
 [  9  87]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For the individual metrics:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy:  </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Recall:    </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">yhat_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy:  0.94
Precision: 0.97
Recall:    0.91
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-area-uder-the-curve-auc-metric">
<h2>The Area Uder the Curve (AUC) metric<a class="headerlink" href="#the-area-uder-the-curve-auc-metric" title="Link to this heading">#</a></h2>
<p>Let’s go back to <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> and its <code class="docutils literal notranslate"><span class="pre">predict_proba()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">phat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># probabilities for each sample in X_test to belong to class 1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probabilities to belong to class 1 (first 6 test samples):</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">phat_test</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Probabilities to belong to class 1 (first 6 test samples):
[0.91578231 0.00710081 0.25147708 0.01135768 0.0097521  0.99999117]
</pre></div>
</div>
</div>
</div>
<p>And we <strong>implicitly</strong> said that where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_1\)</span> &gt; 50% <span class="math notranslate nohighlight">\(~\rightarrow\)</span> <span class="math notranslate nohighlight">\(\hat{y} = 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(p_1\)</span> &lt;= 50% <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\hat{y} = 0\)</span></p></li>
</ul>
<p>This is what is done implicitly when we call <code class="docutils literal notranslate"><span class="pre">predict()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yhat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1"># predicted class for each sample in X_test</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Predicted classes (first 6 test samples):</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">yhat_test</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predicted classes (first 6 test samples):
[1 0 0 0 0 1]
</pre></div>
</div>
</div>
</div>
<p><u><strong>Problem 1</strong></u>: The probabilities are <u>not calibrated</u>!</p>
<p><u><strong>Problem 2</strong></u>: If we change the treshold to, e.g. 70%, <u>all of our metrics change</u>!</p>
<p><u><strong>Problem 3</strong></u>: Different thresholds may <u>favor different models</u>!</p>
<blockquote>
<div><p><em>In other words, the intuitive threshold of 50% is actually <strong>arbitrary</strong></em></p>
</div></blockquote>
<p>So the question becomes <span class="math notranslate nohighlight">\(\rightarrow\)</span> How do I pick the <strong>best threshold</strong>?</p>
<blockquote>
<div><p>Answer: I <strong>try them all</strong>!</p>
</div></blockquote>
<section id="drawing-the-roc-curve">
<h3>Drawing the ROC curve<a class="headerlink" href="#drawing-the-roc-curve" title="Link to this heading">#</a></h3>
<p>Let’s do the following:</p>
<ol class="arabic simple">
<li><p><strong>predict</strong> the probabilities (“scores”)</p></li>
<li><p><strong>vary the threshold</strong> for class 1 attribution, from 0% to 100%</p></li>
</ol>
<p>and, for every threshold:</p>
<ol class="arabic simple" start="3">
<li><p>store the <strong>True Positive Rate</strong> (<strong>TPR</strong>) and <strong>False Positive Rate</strong> (<strong>FPR</strong>)</p></li>
</ol>
<p>If we plot TPR <span class="math notranslate nohighlight">\(vs\)</span> FPR we obtain the so-called <strong>Receiving Operator Characteristic</strong> (<strong>ROC</strong>) curve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">phat_test</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;NOTE: `roc_curve` takes as an input the true labels and the probabilities,</span>
<span class="sd">          NOT the predicted classes!</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">roc_auc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

<span class="n">display</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">RocCurveDisplay</span><span class="p">(</span><span class="n">fpr</span><span class="o">=</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="o">=</span><span class="n">tpr</span><span class="p">,</span> <span class="n">roc_auc</span><span class="o">=</span><span class="n">roc_auc</span><span class="p">,</span>
                                  <span class="n">estimator_name</span><span class="o">=</span><span class="s1">&#39;sklearn&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC curve&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6a1ca7ea93b993bc6baf34f7a16706c4e7546a139a0a345dbddb09434346eede.png" src="../../_images/6a1ca7ea93b993bc6baf34f7a16706c4e7546a139a0a345dbddb09434346eede.png" />
</div>
</div>
<p>So, if we were to compare <strong>different models</strong>  across <strong>all possible threshold</strong>, which one we would select as the best?</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Let’s plot their ROCs on the same graph <span class="math notranslate nohighlight">\(-\)</span> we should observe something like that:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../../_images/8fec40aa3e583064d4e7b7fe5587bce13d3438ecc603b1f4c42347617ef3de11.png" src="../../_images/8fec40aa3e583064d4e7b7fe5587bce13d3438ecc603b1f4c42347617ef3de11.png" />
</div>
</div>
<blockquote>
<div><p>The best classifier is the one that performs best, on average, over all thresholds</p>
</div></blockquote>
<p>We can use, as a metric, the:</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> <strong>Area Under the Curve</strong> (<strong>AUC</strong>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span>

<span class="n">AUC</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">phat_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC score for this classifier: </span><span class="si">%.2f</span><span class="s1"> (optimal classifier AUC = 1)&#39;</span> <span class="o">%</span> <span class="n">AUC</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC score for this classifier: 0.95 (optimal classifier AUC = 1)
</pre></div>
</div>
</div>
</div>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=6><strong>Exercise [45 mins]</strong></font></p>
<p><strong>Objective:</strong> Draw the ROC curve for a 2 class problem.</p>
<p>We will classify it using the <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> classifier.</p>
<p><em>NOTE: This example presents a simplified calculation that does deal with ties (when 2 samples have the same probability to belong to class 1) <span class="math notranslate nohighlight">\(-\)</span> for real cases just use the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> function.</em></p>
</div></section>
</section>
<section id="preparing-dataset">
<h2>Preparing dataset<a class="headerlink" href="#preparing-dataset" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Let&#39;s create some mock data:</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">class_sep</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>


<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;C1&#39;</span><span class="p">}</span>
<span class="c1"># colors dictionary indexed by class label</span>

<span class="c1"># Plot:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fd1ee3ed54ce9f40f929bc87e950f59238a48a40c14e698f2ebf35b1c4dd23c4.png" src="../../_images/fd1ee3ed54ce9f40f929bc87e950f59238a48a40c14e698f2ebf35b1c4dd23c4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split dataset in train and test:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train shape:&#39;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test  shape:&#39;</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train shape: (800, 2)
Test  shape: (200, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define and train the classifier:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression()</pre></div> </div></div></div></div></div></div>
</div>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=4><strong>Calculating ROC</strong></font></p>
<p>The task is composed of 2 steps:</p>
<ol class="arabic simple">
<li><p>retrieve and sort the scores produced by the classifier</p></li>
<li><p>calculate <strong>True Positive Ratio</strong> (<strong>TPR</strong>) and  <strong>False Positive Ratio</strong> (<strong>FPR</strong>) for each threshold</p></li>
</ol>
<p><font size=4><strong>Step 1</strong></font></p>
<p>Sort the scores:</p>
<ul class="simple">
<li><p>Get the predictions and the scores</p></li>
<li><p>Sort the scores</p></li>
<li><p>Sort the true labels and the predicted labels in the <em>same</em> order as
the scores<br></p></li>
</ul>
<p><strong>Hint:</strong> Sort scores using indexes, then apply to the 3 arrays.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Uncomment the lines, and replace &quot;...&quot; with the proper code&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c1"># import numpy as np</span>

<span class="c1"># yhat_test = clf.predict(...)</span>
<span class="c1"># phat_test = clf.predict_proba(...)[:, 1]</span>
<span class="c1"># # probability to belong to class 1 for each sample in `X_test`</span>

<span class="c1"># # Sort arrays by probability (high probability first):</span>
<span class="c1"># idxs_sorted = np.argsort(...)[::-1]</span>

<span class="c1"># y_test_s    = y_test[idxs_sorted]</span>
<span class="c1"># yhat_test_s = yhat_test[idxs_sorted]</span>
<span class="c1"># phat_test_s = phat_test[idxs_sorted]</span>

<span class="c1"># assert len(np.unique(phat_test_s)) == len(phat_test_s), \</span>
<span class="c1">#     &quot;There are probability ties, cannot continue.&quot;</span>
</pre></div>
</div>
</div>
</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p><em>Our solution</em></p>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">yhat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">phat_test</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># probability to belong to class 1 for each sample in `X_test`</span>

<span class="c1"># Sort arrays by probability (high probability first):</span>
<span class="n">idxs_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">phat_test</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">y_test_s</span>    <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">idxs_sorted</span><span class="p">]</span>
<span class="n">yhat_test_s</span> <span class="o">=</span> <span class="n">yhat_test</span><span class="p">[</span><span class="n">idxs_sorted</span><span class="p">]</span>
<span class="n">phat_test_s</span> <span class="o">=</span> <span class="n">phat_test</span><span class="p">[</span><span class="n">idxs_sorted</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">phat_test_s</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">phat_test_s</span><span class="p">),</span> \
    <span class="s2">&quot;There are probability ties, cannot continue.&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=4><strong>Step 2</strong></font></p>
<p>Calculate TPR and FPR for each threshold.</p>
<ul class="simple">
<li><p>Create a new ‘proxy’ predictions array &lt;yhat_test_s_prime&gt; and set all
predictions to class ‘False’.</p></li>
<li><p>Then, start iterating through the thresholds:</p>
<ol class="arabic simple">
<li><p>Start from the largest score value, set the threshold to that value</p></li>
<li><p>Set all predictions above that threshold to class ‘True’</p></li>
<li><p>Calculate TPR and FPR for this threshold, and store</p></li>
<li><p>Move threshold to the second largest score value, and repeat from 2</p></li>
</ol>
</li>
</ul>
<p>Since you have as many thresholds as scores, you will end up with as many
TPRs (FPRs) as samples.</p>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p><strong>Hint</strong>: A quick way to count the True Positives (TPs) is to check where
the actual label is ‘True’ and the proxy label is ‘True’ as well.
Because the variables are boolean, you can use the ‘logical AND’ <span class="math notranslate nohighlight">\(-\)</span>
something like this:</p>
<blockquote>
<div><p>TP = count ( y_true AND y_proxy )</p>
</div></blockquote>
<p>Look at the_ <code>np.logical_and</code> _function.
You can use the same trick to calculate FN, FP, and TN.</p>
<p>Once you have those, just apply the definitions:</p>
<blockquote>
<div><p>TPR = TP/(TP+FN)</p>
<p>FPR = FP/(FP+TN)</p>
</div></blockquote>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Uncomment the lines, and replace &quot;...&quot; with the proper code&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c1"># yhat_test_s_prime = np.zeros(len(yhat_test_s), dtype=bool)</span>

<span class="c1"># TPRs = []</span>
<span class="c1"># FPRs = []</span>

<span class="c1"># for i in range(len(phat_test_s)):</span>
        
<span class="c1">#     yhat_test_s_prime[:i] = 1</span>
    
<span class="c1">#     TP = len(np.where(np.logical_and(yhat_test_s_prime, y_test_s.astype(bool)) == 1)[0])</span>
<span class="c1">#     FN = len(np.where(np.logical_and(~yhat_test_s_prime, y_test_s.astype(bool)) == 1)[0])</span>

<span class="c1">#     FP = ...</span>
<span class="c1">#     TN = ...</span>

<span class="c1">#     TPR = ...</span>
<span class="c1">#     FPR = ...</span>
    
<span class="c1">#     TPRs.append(TPR)</span>
<span class="c1">#     FPRs.append(FPR)</span>
</pre></div>
</div>
</div>
</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p><em>Our solution</em></p>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yhat_test_s_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yhat_test_s</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

<span class="n">TPRs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">FPRs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phat_test_s</span><span class="p">)):</span>
        
    <span class="n">yhat_test_s_prime</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">TP</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">yhat_test_s_prime</span><span class="p">,</span> <span class="n">y_test_s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">FN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">yhat_test_s_prime</span><span class="p">,</span> <span class="n">y_test_s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">FP</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">yhat_test_s_prime</span><span class="p">,</span> <span class="o">~</span><span class="n">y_test_s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">TN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">yhat_test_s_prime</span><span class="p">,</span> <span class="o">~</span><span class="n">y_test_s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">TPR</span> <span class="o">=</span> <span class="n">TP</span><span class="o">/</span><span class="p">(</span><span class="n">TP</span><span class="o">+</span><span class="n">FN</span><span class="p">)</span>
    <span class="n">FPR</span> <span class="o">=</span> <span class="n">FP</span><span class="o">/</span><span class="p">(</span><span class="n">FP</span><span class="o">+</span><span class="n">TN</span><span class="p">)</span>
    
    <span class="n">TPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TPR</span><span class="p">)</span>
    <span class="n">FPRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FPR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-the-roc-curve">
<h2>Plot the ROC curve<a class="headerlink" href="#plot-the-roc-curve" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FPRs</span><span class="p">,</span> <span class="n">TPRs</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC curve&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/37863c46cc8339d87a1e1510c343b2b8f04bfa5418a6b2c316f65a1884508f4b.png" src="../../_images/37863c46cc8339d87a1e1510c343b2b8f04bfa5418a6b2c316f65a1884508f4b.png" />
</div>
</div>
</section>
<section id="comparison-agains-sklearn-function">
<h2>Comparison agains sklearn function<a class="headerlink" href="#comparison-agains-sklearn-function" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">phat_test</span><span class="p">)</span>
<span class="n">roc_auc</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">display</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">RocCurveDisplay</span><span class="p">(</span><span class="n">fpr</span><span class="o">=</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="o">=</span><span class="n">tpr</span><span class="p">,</span> <span class="n">roc_auc</span><span class="o">=</span><span class="n">roc_auc</span><span class="p">,</span>
                                  <span class="n">estimator_name</span><span class="o">=</span><span class="s1">&#39;sklearn&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FPRs</span><span class="p">,</span> <span class="n">TPRs</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;my ROC&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC curve comparison&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c9929c608d24e745c8e749ca812c316de45e9dd2796a0be259454b83d5ea8498.png" src="../../_images/c9929c608d24e745c8e749ca812c316de45e9dd2796a0be259454b83d5ea8498.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ml_book"
        },
        kernelOptions: {
            name: "ml_book",
            path: "./chapters/chapter4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ml_book'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../chapter3/C30_using_sklearn.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Using sklearn models <a class="tocSkip"></p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Classification <a class="tocSkip"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simplest-case-1d-class-separation">The simplest case: 1D class separation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-logistic-regression-problem">Solving the Logistic Regression problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-conditional-likelihood">Calculating the conditional Likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-last-semplification-and-we-are-done">One last semplification, and we are done</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-gradient-descent">Using Gradient Descent</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thank-sklearn-for-one-liner-logisticregression">Thank sklearn for one-liner LogisticRegression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">Visualizing the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbors-classifier-a-k-a-knn"><span class="math notranslate nohighlight">\(k\)</span>-Nearest Neighbors classifier (a.k.a. <span class="math notranslate nohighlight">\(k\)</span>NN)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-the-1d-problem">Back to the 1D problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-in-multi-dimension-multi-class"><span class="math notranslate nohighlight">\(k\)</span>NN in multi-dimension, multi-class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-decision-boundaries">Visualizing the Decision Boundaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-decision-function">Visualizing the Decision Function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-of-performance">Metrics of Performance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#golden-rule-and-data-splitting">Golden rule and data splitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confusion-matrix">Confusion Matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics">Metrics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confusion-matrix-and-metrics-in-sklearn">Confusion Matrix and metrics in sklearn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-area-uder-the-curve-auc-metric">The Area Uder the Curve (AUC) metric</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drawing-the-roc-curve">Drawing the ROC curve</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-dataset">Preparing dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-roc-curve">Plot the ROC curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-agains-sklearn-function">Comparison agains sklearn function</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Paolo Bonfini
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>