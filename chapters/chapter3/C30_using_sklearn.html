
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using sklearn models &#8212; ML for Natural Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/chapter3/C30_using_sklearn';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Classification" href="../chapter4/C40_classification.html" />
    <link rel="prev" title="Basics of Optimization" href="../chapter2/C20_optimization_basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">ML for Natural Sciences</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Machine Learning for Natural Sciences
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter1/C10_object_oriented_programming.html">Object-oriented Programming in Python <a class="tocSkip"></a></a></li>




<li class="toctree-l1"><a class="reference internal" href="../chapter2/C20_optimization_basics.html">Basics of Optimization <a class="tocSkip"></a></a></li>





<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using sklearn models <a class="tocSkip"></a></a></li>



<li class="toctree-l1"><a class="reference internal" href="../chapter4/C40_classification.html">Classification <a class="tocSkip"></a></a></li>




</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/gitpeblo/ML_book/blob/main/ML_book_site/chapters/chapter3/C30_using_sklearn.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/chapter3/C30_using_sklearn.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using sklearn models <a class="tocSkip"></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Using sklearn models <a class="tocSkip"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-datasets">Sklearn datasets</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting">Fitting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-i-want-to-switch-to-another-model">What if I want to switch to another model?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-issue">Regularization issue</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-ridiculously-overfitting-black-box-model">Fitting a ridiculously overfitting “black box” model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-alternative-bootstrapping">Regularization alternative: bootstrapping</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-sklearn-models">
<h1>Using sklearn models <a class="tocSkip"><a class="headerlink" href="#using-sklearn-models" title="Link to this heading">#</a></h1>
<font size=1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Paolo Bonfini, 2025. All rights reserved.
</pre></div>
</div>
<p>This work is the intellectual property of <code class="docutils literal notranslate"><span class="pre">Paolo</span> <span class="pre">Bonfini</span></code>. All content produced in this notebook is original creation of the author unless specified otherwise. Unauthorized use, reproduction, or distribution of this material, in whole or in part, without explicit permission from the author, is strictly prohibited.
</font></p>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p>In the following example we will see how to use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s models to fit some data.</p>
<p>We will try a simple <strong>linear</strong> model and then switch to a more <strong>complex</strong> one.</p>
<p><em>NOTE: We saw a lot of linear models in the previous lecture, but here we see how to define and fit them in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</em></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="sklearn-datasets">
<h1>Sklearn datasets<a class="headerlink" href="#sklearn-datasets" title="Link to this heading">#</a></h1>
<p>Scikit-learn provides several <strong>built-in datasets</strong> for practicing ML.</p>
<p>We will use the <strong>Diabetes</strong> dataset, which contains:</p>
<ul class="simple">
<li><p>10 baseline health variables for patients (<span class="math notranslate nohighlight">\(\pmb{X}\)</span>)</p></li>
<li><p>a target value representing disease progression one year later (<span class="math notranslate nohighlight">\(y\)</span>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load dataset</span>
<span class="n">diabetes</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span>

<span class="c1"># Convert dataset to pandas dataframe</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diabetes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">diabetes</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diabetes</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># Preview</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>bmi</th>
      <th>bp</th>
      <th>s1</th>
      <th>s2</th>
      <th>s3</th>
      <th>s4</th>
      <th>s5</th>
      <th>s6</th>
      <th>disease_progression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.038076</td>
      <td>0.050680</td>
      <td>0.061696</td>
      <td>0.021872</td>
      <td>-0.044223</td>
      <td>-0.034821</td>
      <td>-0.043401</td>
      <td>-0.002592</td>
      <td>0.019907</td>
      <td>-0.017646</td>
      <td>151.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.001882</td>
      <td>-0.044642</td>
      <td>-0.051474</td>
      <td>-0.026328</td>
      <td>-0.008449</td>
      <td>-0.019163</td>
      <td>0.074412</td>
      <td>-0.039493</td>
      <td>-0.068332</td>
      <td>-0.092204</td>
      <td>75.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.085299</td>
      <td>0.050680</td>
      <td>0.044451</td>
      <td>-0.005670</td>
      <td>-0.045599</td>
      <td>-0.034194</td>
      <td>-0.032356</td>
      <td>-0.002592</td>
      <td>0.002861</td>
      <td>-0.025930</td>
      <td>141.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.089063</td>
      <td>-0.044642</td>
      <td>-0.011595</td>
      <td>-0.036656</td>
      <td>0.012191</td>
      <td>0.024991</td>
      <td>-0.036038</td>
      <td>0.034309</td>
      <td>0.022688</td>
      <td>-0.009362</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005383</td>
      <td>-0.044642</td>
      <td>-0.036385</td>
      <td>0.021872</td>
      <td>0.003935</td>
      <td>0.015596</td>
      <td>0.008142</td>
      <td>-0.002592</td>
      <td>-0.031988</td>
      <td>-0.046641</td>
      <td>135.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Each <strong>row</strong> in the Diabetes dataset corresponds to a <strong>single patient</strong>.</p>
<p>The <strong>columns</strong> represent:</p>
<ul class="simple">
<li><p><strong>age</strong> — age of the patient</p></li>
<li><p><strong>sex</strong> — sex of the patient</p></li>
<li><p><strong>bmi</strong> — body mass index (weight in kg / height in m²)</p></li>
<li><p><strong>bp</strong> — average blood pressure</p></li>
<li><p><strong>s1</strong> — total serum cholesterol</p></li>
<li><p><strong>s2</strong> — low-density lipoprotein cholesterol (LDL)</p></li>
<li><p><strong>s3</strong> — high-density lipoprotein cholesterol (HDL)</p></li>
<li><p><strong>s4</strong> — total cholesterol / HDL ratio</p></li>
<li><p><strong>s5</strong> — log of serum triglycerides level</p></li>
<li><p><strong>s6</strong> — blood sugar level</p></li>
<li><p><strong>disease_progression</strong> — a quantitative measure of how much the disease has progressed one year after baseline</p></li>
</ul>
<p>Our objective will be to predict <strong>disease_progression</strong> (<span class="math notranslate nohighlight">\(y\)</span>) using one of the other variables <span class="math notranslate nohighlight">\(-\)</span> let’s use <strong>s1</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Prepare the data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]]</span> <span class="c1"># 2D array</span>
<span class="c1"># OR:</span>
<span class="c1">#y = np.c_[df_data[&quot;**disease_progression**&quot;]].flatten() # 1D array</span>

<span class="c1"># Visualize the data (using pandas plotting methods)</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef9c14bb4618d448990ddbc25bce038e563ef55f6909c327e95c03491e6ba4bd.png" src="../../_images/ef9c14bb4618d448990ddbc25bce038e563ef55f6909c327e95c03491e6ba4bd.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fitting">
<h1>Fitting<a class="headerlink" href="#fitting" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a linear model</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.linear_model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">That is all there is to do in `sklearn` to define a linear model!</span>

<span class="sd"># This defines the generic multi-dimensional linear model (see previous lecture).</span>
<span class="sd"># The actual dimensionality of the model is sorted out internally, from the data</span>
<span class="sd"># we will pass.</span>
<span class="sd"># &#39;&#39;&#39;</span>

<span class="c1"># Train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Make a prediction for s1 == 0</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prediction for s1 == 0: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">))</span>

<span class="c1"># Plot prediction on top of previous plot</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction for s1=0&#39;</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;When we plotted above, we created a `figure` object implicitly.</span>
<span class="sd">If you keep plotting without invoking `plt.show()`, you keep adding to the</span>
<span class="sd">same figure.&#39;&#39;&#39;</span>

<span class="c1"># Predict for the whole training set</span>
<span class="n">yhat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Plot all predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction for s1 == 0: [[152.13348416]]
</pre></div>
</div>
<img alt="../../_images/a4b9176e535f727d5af1324ca75ba82c827b881b89eed8562ebe3926ec4b6aa6.png" src="../../_images/a4b9176e535f727d5af1324ca75ba82c827b881b89eed8562ebe3926ec4b6aa6.png" />
</div>
</div>
<ul class="simple">
<li><p>Notice how <u>all</u> the sklearn inputs (<span class="math notranslate nohighlight">\(\pmb{X}\)</span>) are expected to be 2D:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of the X input:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of the X_new input:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X_new</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of the X input: (442, 1)
Shape of the X_new input: (1, 1)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>For the target (<span class="math notranslate nohighlight">\(\pmb{y}\)</span>), you can input <u>1D or 2D</u>, but if you input 2D (/1D) you get returned 2D (/1D):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of the y input:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape of the yhat output:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">yhat</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of the y input: (442, 1)
Shape of the yhat output: (442, 1)
</pre></div>
</div>
</div>
</div>
<section id="what-if-i-want-to-switch-to-another-model">
<h2>What if I want to switch to another model?<a class="headerlink" href="#what-if-i-want-to-switch-to-another-model" title="Link to this heading">#</a></h2>
<p>E.g., switch from <strong>Linear Regression</strong> model to <strong>k-Nearest Neighbors</strong> regression (<em>take it as a black box for now</em>)<br>
<span class="math notranslate nohighlight">\(\rightarrow\)</span> replace these two lines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.linear_model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
</pre></div>
</div>
<p>with these two:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.neighbors</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a 3-Nearest Neighbors regression model</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.neighbors</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Make a prediction for bmi==0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[126.33333333]]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="regularization-issue">
<h1>Regularization issue<a class="headerlink" href="#regularization-issue" title="Link to this heading">#</a></h1>
<p>Let’s assume we have an <strong>overfitting</strong> problem <span class="math notranslate nohighlight">\(-\)</span> we use the same data as before … <em>plus a few more data points</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load dataset</span>
<span class="n">diabetes</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span>

<span class="c1"># Restric to the columns of interest</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diabetes</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">])</span>
<span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diabetes</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># Preview</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>s1</th>
      <th>disease_progression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.061696</td>
      <td>151.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.051474</td>
      <td>75.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.044451</td>
      <td>141.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.011595</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.036385</td>
      <td>135.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s now add some [mock] data <strong>extending</strong> the set we used so far:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Get min and max s1</span>
<span class="n">min_s1</span><span class="p">,</span> <span class="n">max_s1</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Mock data: some inside the range, some beyond</span>
<span class="n">data_added</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;mock1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">min_s1</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>    <span class="c1"># inside range</span>
    <span class="s2">&quot;mock2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">min_s1</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>   <span class="c1"># inside range</span>
    <span class="s2">&quot;mock3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">max_s1</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>   <span class="c1"># inside range</span>
    <span class="s2">&quot;mock4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">max_s1</span> <span class="o">+</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span>   <span class="c1"># beyond range</span>
    <span class="s2">&quot;mock5&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">max_s1</span> <span class="o">+</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mi">380</span><span class="p">),</span>   <span class="c1"># beyond range</span>
<span class="p">}</span>

<span class="c1"># Convert to DataFrame</span>
<span class="n">df_data_added</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_added</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_data_added</span> <span class="o">=</span> <span class="n">df_data_added</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;disease_progression&quot;</span><span class="p">})</span>

<span class="c1"># Extend dataset</span>
<span class="n">df_data_ext</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_data</span><span class="p">,</span> <span class="n">df_data_added</span><span class="p">[[</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="s2">&quot;disease_progression&quot;</span><span class="p">]]],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span>  <span class="n">x</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">)</span>
<span class="n">df_data_added</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mock data&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">430</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/aaf908dd7bf87a7f53c9128a1e604118bae38a887c7ed8d4f6ccd46d3a41f135.png" src="../../_images/aaf908dd7bf87a7f53c9128a1e604118bae38a887c7ed8d4f6ccd46d3a41f135.png" />
</div>
</div>
<section id="fitting-a-ridiculously-overfitting-black-box-model">
<h2>Fitting a ridiculously overfitting “black box” model<a class="headerlink" href="#fitting-a-ridiculously-overfitting-black-box-model" title="Link to this heading">#</a></h2>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> algorithm.</p>
<p>Simply speaking, <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> just takes the average of the nearest <span class="math notranslate nohighlight">\(k\)</span> points, but we will think of it as a “<em>black box</em>”, for the purpose of this example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.neighbors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Prepare the data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_data_ext</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_data_ext</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]]</span> <span class="c1"># 2D array</span>

<span class="c1"># Normalize, for good habits</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_n</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Fit</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_n</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Predict on a range, to display the model curve</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">xx_n</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="sd">&#39;&#39;&#39; `x` this needs to be normalized as well&#39;&#39;&#39;</span>
<span class="n">yy_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xx_n</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">df_data_ext</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">430</span><span class="p">])</span>
<span class="c1"># ^This is here only to have the same range as the above figure</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy_model</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6805a4464366ae34e5ca21d5c132f4bb07eafd1e340f71abf91cb856d7e57023.png" src="../../_images/6805a4464366ae34e5ca21d5c132f4bb07eafd1e340f71abf91cb856d7e57023.png" />
</div>
</div>
<blockquote>
<div><p><em>As you can see, it [almost] goes through each and every point.</em></p>
</div></blockquote>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> A model like this needs to be <strong>regularized</strong> == reduce its “<em>degrees of freedom</em>”</p>
</section>
<section id="regularization-alternative-bootstrapping">
<h2>Regularization alternative: bootstrapping<a class="headerlink" href="#regularization-alternative-bootstrapping" title="Link to this heading">#</a></h2>
<p>We will see proper <em>regularization</em> tricks in the future classes</p>
<blockquote>
<div><p>Now let’s see how we can place <strong>confidence intervals</strong> to a model.</p>
</div></blockquote>
<ul class="simple">
<li><p>using <strong>parameters</strong> <span class="math notranslate nohighlight">\(\rightarrow\)</span> We could sample models around the <em>best-fitting</em> form the parameter errors (<em>see e.g., Least Squares</em>)</p></li>
<li><p>using the <strong>data</strong>    <span class="math notranslate nohighlight">\(\rightarrow\)</span>  We could <u>resample the data</u> multiple times and fit again.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>

<span class="k">def</span><span class="w"> </span><span class="nf">draw_bootstrap_diagram</span><span class="p">(</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a bootstrapping diagram with an original sample of N unique colors (diamond layout)</span>
<span class="sd">    on the left, and 4 bootstrap samples (with replacement) on the right.</span>
<span class="sd">    Numbers are not shown; colors identify items.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    seed : int | None, optional</span>
<span class="sd">        Random seed for reproducibility.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The matplotlib figure object.</span>
<span class="sd">    samples : list[list[int]]</span>
<span class="sd">        List of bootstrap samples (indices of the original sample).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># 5 distinct colors</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#1f77b4&quot;</span><span class="p">,</span> <span class="s2">&quot;#ff7f0e&quot;</span><span class="p">,</span> <span class="s2">&quot;#2ca02c&quot;</span><span class="p">,</span> <span class="s2">&quot;#d62728&quot;</span><span class="p">,</span> <span class="s2">&quot;#9467bd&quot;</span><span class="p">]</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>

    <span class="c1"># Diamond-like layout for original sample</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">left_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">spacing</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">spacing</span><span class="p">,</span> <span class="n">spacing</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">spacing</span><span class="p">),</span>
        <span class="p">(</span><span class="n">spacing</span><span class="p">,</span> <span class="n">spacing</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># Bootstrap samples: 4 rows, each with N draws (with replacement)</span>
    <span class="n">n_bootstraps</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">draws_per_row</span> <span class="o">=</span> <span class="n">n_samples</span>
    <span class="n">samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">draws_per_row</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Figure</span>
    <span class="n">fig_w</span><span class="p">,</span> <span class="n">fig_h</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_w</span><span class="p">,</span> <span class="n">fig_h</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="c1"># Draw separator line</span>
    <span class="n">sep_x</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">sep_x</span><span class="p">,</span> <span class="n">sep_x</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

    <span class="c1"># Draw original sample balls</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">left_positions</span><span class="p">):</span>
        <span class="n">circ</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="s2">&quot;original dataset&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Draw bootstrap samples</span>
    <span class="n">start_x</span> <span class="o">=</span> <span class="n">sep_x</span> <span class="o">+</span> <span class="mf">1.2</span>
    <span class="n">row_y0</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">row_gap</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">col_gap</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">row_y0</span> <span class="o">-</span> <span class="n">row_idx</span> <span class="o">*</span> <span class="n">row_gap</span>
        <span class="k">for</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">item_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">col_idx</span> <span class="o">*</span> <span class="n">col_gap</span>
            <span class="n">circ</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">item_idx</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">start_x</span> <span class="o">+</span> <span class="n">draws_per_row</span> <span class="o">*</span> <span class="n">col_gap</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;bootstrap dataset </span><span class="si">{</span><span class="n">row_idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">samples</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">draw_bootstrap_diagram</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/0b96b46bcbc1c19e0043347ac61555401d3f3d95df58c87b8b9ff85fd6fc4c6e.png" src="../../_images/0b96b46bcbc1c19e0043347ac61555401d3f3d95df58c87b8b9ff85fd6fc4c6e.png" />
</div>
</div>
<p><strong>Bootstrapping == random sampling with replacement</strong></p>
<blockquote>
<div><p><em>The assumption is that every bootstrapped sampled is a representative sub-sample of the true population.</em></p>
</div></blockquote>
<p><u>IMPORTANT:</u> There is <strong>replacement</strong> <span class="math notranslate nohighlight">\(-\)</span> some samples can appear multiple times in a bootstrapped dataset.</p>
<p>This is how to do it in python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">resample</span>

<span class="n">n_bootstraps</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Perform bootstrapping multiple times</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">):</span>
    <span class="n">df_bootstrap_data</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">df_data_ext</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
    
    <span class="c1"># Prepare the data</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_bootstrap_data</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_bootstrap_data</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]]</span> <span class="c1"># 2D array</span>
<span class="w">    </span>
<span class="sd">&#39;&#39;&#39;Notice that each bootstrapped dataset has the same lenght as the original.&#39;&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lenght of original data: </span><span class="si">%s</span><span class="s1"> samples&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_data_ext</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lenght of the last bootstapped dataset: </span><span class="si">%s</span><span class="s1"> samples&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_bootstrap_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;By construction, some values may appear more than once.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of value repetitions inside the bootstrap datasets:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_bootstrap_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lenght of original data: 447 samples
Lenght of the last bootstapped dataset: 447 samples

By construction, some values may appear more than once.
Number of value repetitions inside the bootstrap datasets:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>s1
-0.083808    1
-0.081653    2
-0.080575    1
-0.079497    1
-0.077342    2
            ..
 0.128521    2
 0.160855    1
 0.170555    1
 0.210555    1
 0.250555    1
Length: 146, dtype: int64
</pre></div>
</div>
</div>
</div>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=6><strong>Exercise [20 min]</strong></font></p>
<p><strong>Objective:</strong> Use bootstrapping to display the <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> model uncertainty in a plot.</p>
<p>You should obtain something like this:</p>
<a class="reference internal image-reference" href="../../_images/ex1_expected_result.png"><img alt="../../_images/ex1_expected_result.png" src="../../_images/ex1_expected_result.png" style="width: 600px;" />
</a>
<br>
<p><strong>Task:</strong>  In particular, you will have to:</p>
<ol class="arabic simple">
<li><p>Fit the model on each bootstrapped dataset</p></li>
<li><p>For each fitted model, add a curve to the plot</p></li>
</ol>
<p><strong>Hints:</strong></p>
<ul class="simple">
<li><p>Keep <code class="docutils literal notranslate"><span class="pre">n_bootstraps</span></code> low while you are testing, then increase it to 1000.</p></li>
</ul>
</div>    <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Uncomment the lines, and replace &quot;...&quot; with the proper code&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c1"># from sklearn.utils import resample</span>

<span class="c1"># ... # Import model and normalization</span>
<span class="c1"># ... # Initialize figure with the data alone</span>

<span class="c1"># n_bootstraps = ...</span>

<span class="c1"># # Perform bootstrapping</span>
<span class="c1"># for _ in range(n_bootstraps):</span>
<span class="c1">#     df_bootstrap_data = resample(df_data_ext, replace=True)  </span>
    
<span class="c1">#     # Prepare the data:</span>
<span class="c1">#     X = np.c_[df_bootstrap_data[&quot;s1&quot;]]</span>
<span class="c1">#     y = np.c_[df_bootstrap_data[&quot;disease_progression&quot;]] # 2D array</span>

<span class="c1">#     ...</span>
</pre></div>
</div>
</div>
</div>
<hr style="height:0.5px; border:none; color:lightgray; background-color:lightgray;">
<p><em>Our solution</em></p>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Same as above, but we repeat `n_boostraps` tiems, each time fitting on a</span>
<span class="sd">different bootstrapped dataset.&#39;&#39;&#39;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.neighbors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Initialize plot with actual data</span>
<span class="n">df_data_ext</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;disease_progression&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">430</span><span class="p">])</span>
<span class="c1"># ^This is here only to have the same range as the above figure</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">resample</span>

<span class="n">n_bootstraps</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Perform bootstrapping multiple times</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">):</span>
    <span class="n">df_bootstrap_data</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">df_data_ext</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
    
    <span class="c1"># Prepare the data</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_bootstrap_data</span><span class="p">[</span><span class="s2">&quot;s1&quot;</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">df_bootstrap_data</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]]</span> <span class="c1"># 2D array</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    And that&#39;s all, the rest is just copy-pasta from above, just replacing:</span>
<span class="sd">        `df_data_ext` --&gt; `df_bootstrap_sample`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Normalize, for good habits</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_n</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># 1. Fit</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_n</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># 2. Predict on a range, to display the model curve</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">xx_n</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; `x` this needs to be normalized as well&#39;&#39;&#39;</span>
    <span class="n">yy_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xx_n</span><span class="p">)</span>

    <span class="c1"># Plot bootstrapped model</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy_model</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="n">n_bootstraps</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ab36e0f02e24ebc1f5c0be5a0fbb3ec26eef9a85ff19173e0d3aecf84e12a035.png" src="../../_images/ab36e0f02e24ebc1f5c0be5a0fbb3ec26eef9a85ff19173e0d3aecf84e12a035.png" />
</div>
</details>
</div>
<p>This gives us a better feeling of the uncertainty on the model, although in the case of <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> we would probably need to calibrate also the hyperparameter <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code>.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>We will see how in future classes.</em></p>
<div style="border-left: 5px solid #FFA500; background-color: rgba(255, 165, 0, 0.15); padding: 10px; border-radius: 4px; color: inherit;">
<p><font size=6><strong>Exercise [45 min]</strong></font></p>
<p><strong>Objective:</strong> Try to find the feature that correlates the best with <code class="docutils literal notranslate"><span class="pre">disease_progression</span></code>, in the provided dataset.</p>
<p><strong>Tasks:</strong></p>
<ul class="simple">
<li><p>Perform your search by inspecting <code class="docutils literal notranslate"><span class="pre">disease_progression</span></code> <em>against</em> any other variable of your choice in the dataset</p></li>
<li><p>Fit  <code class="docutils literal notranslate"><span class="pre">disease_progression</span></code> using your best candidate variable</p></li>
</ul>
<p><strong>Hints:</strong></p>
<ul>
<li><p>You can use a <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> or <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code></p>
  </div></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load dataset</span>
<span class="n">diabetes</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">()</span>

<span class="c1"># Restric to the columns of interest</span>
<span class="n">df_data_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diabetes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">diabetes</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">df_data_full</span><span class="p">[</span><span class="s2">&quot;disease_progression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diabetes</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># Preview</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_data_full</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset length: </span><span class="si">%s</span><span class="s2"> samples&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_data_full</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>bmi</th>
      <th>bp</th>
      <th>s1</th>
      <th>s2</th>
      <th>s3</th>
      <th>s4</th>
      <th>s5</th>
      <th>s6</th>
      <th>disease_progression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.038076</td>
      <td>0.050680</td>
      <td>0.061696</td>
      <td>0.021872</td>
      <td>-0.044223</td>
      <td>-0.034821</td>
      <td>-0.043401</td>
      <td>-0.002592</td>
      <td>0.019907</td>
      <td>-0.017646</td>
      <td>151.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.001882</td>
      <td>-0.044642</td>
      <td>-0.051474</td>
      <td>-0.026328</td>
      <td>-0.008449</td>
      <td>-0.019163</td>
      <td>0.074412</td>
      <td>-0.039493</td>
      <td>-0.068332</td>
      <td>-0.092204</td>
      <td>75.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.085299</td>
      <td>0.050680</td>
      <td>0.044451</td>
      <td>-0.005670</td>
      <td>-0.045599</td>
      <td>-0.034194</td>
      <td>-0.032356</td>
      <td>-0.002592</td>
      <td>0.002861</td>
      <td>-0.025930</td>
      <td>141.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.089063</td>
      <td>-0.044642</td>
      <td>-0.011595</td>
      <td>-0.036656</td>
      <td>0.012191</td>
      <td>0.024991</td>
      <td>-0.036038</td>
      <td>0.034309</td>
      <td>0.022688</td>
      <td>-0.009362</td>
      <td>206.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005383</td>
      <td>-0.044642</td>
      <td>-0.036385</td>
      <td>0.021872</td>
      <td>0.003935</td>
      <td>0.015596</td>
      <td>0.008142</td>
      <td>-0.002592</td>
      <td>-0.031988</td>
      <td>-0.046641</td>
      <td>135.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset length: 442 samples
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ml_book"
        },
        kernelOptions: {
            name: "ml_book",
            path: "./chapters/chapter3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ml_book'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../chapter2/C20_optimization_basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Basics of Optimization <a class="tocSkip"></p>
      </div>
    </a>
    <a class="right-next"
       href="../chapter4/C40_classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Classification <a class="tocSkip"></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Using sklearn models <a class="tocSkip"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-datasets">Sklearn datasets</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting">Fitting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-i-want-to-switch-to-another-model">What if I want to switch to another model?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-issue">Regularization issue</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-ridiculously-overfitting-black-box-model">Fitting a ridiculously overfitting “black box” model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regularization-alternative-bootstrapping">Regularization alternative: bootstrapping</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Paolo Bonfini
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>